<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Graph Email Testing</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .step h3 { margin-top: 0; color: #0066cc; }
        .button { display: inline-block; padding: 10px 20px; background: #0066cc; color: white; text-decoration: none; border-radius: 5px; margin: 5px 0; }
        .button:hover { background: #0052a3; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Microsoft Graph Email Integration Test</h1>
    
    <div class="step">
        <h3>Step 1: Check Configuration</h3>
        <p>First, verify that your Azure credentials are properly configured:</p>
        <a href="/auth/graph/status" class="button" target="_blank">Check Status</a>
        <div class="info">
            <strong>Expected Result:</strong> Should show "ready": true with your configuration details
        </div>
    </div>

    <div class="step">
        <h3>Step 2: Authorize Microsoft Access</h3>
        <p>Grant permissions for the app to read emails from documents@42consultingllc.com:</p>
        <a href="/auth/graph/authorize" class="button">Start Authorization</a>
        <div class="info">
            <strong>What happens:</strong> 
            <ol>
                <li>Redirects to Microsoft login</li>
                <li>Sign in with your admin account</li>
                <li>Review and accept permissions</li>
                <li>Redirects back to your app with success message</li>
            </ol>
        </div>
    </div>

    <div class="step">
        <h3>Step 3: Test Connection</h3>
        <p>Verify the connection is working:</p>
        <a href="/auth/graph/test-connection" class="button" target="_blank">Test Connection</a>
        <div class="info">
            <strong>Expected Result:</strong> Should show user info for documents@42consultingllc.com
        </div>
    </div>

    <div class="step">
        <h3>Step 4: Read Recent Emails</h3>
        <p>Get the 5 most recent emails from the mailbox:</p>
        <a href="/auth/graph/test-emails" class="button" target="_blank">Get Recent Emails</a>
        <div class="info">
            <strong>Expected Result:</strong> JSON list of recent emails with subjects, senders, and attachment info
        </div>
    </div>

    <div class="step">
        <h3>Step 5: Test Specific Email</h3>
        <p>After Step 4, you can test reading a specific email with attachments by adding the message ID to this URL:</p>
        <code>/auth/graph/test-email/{MESSAGE_ID}</code>
        <div class="info">
            <strong>How to use:</strong> Copy a message ID from Step 4 results and replace {MESSAGE_ID} in the URL above
        </div>
    </div>

    <hr>

    <h2>Testing Flow</h2>
    <ol>
        <li><strong>Click "Check Status"</strong> - Should show your configuration is ready</li>
        <li><strong>Click "Start Authorization"</strong> - Follow the Microsoft login flow</li>
        <li><strong>Click "Test Connection"</strong> - Verify access is working</li>
        <li><strong>Click "Get Recent Emails"</strong> - See actual emails from your mailbox</li>
    </ol>

    <div class="success">
        <strong>Success Indicators:</strong>
        <ul>
            <li>Status shows "ready": true</li>
            <li>Authorization completes without errors</li>
            <li>Connection test shows user information</li>
            <li>Recent emails shows actual emails from documents@42consultingllc.com</li>
        </ul>
    </div>

    <script>
        // Auto-refresh status every 30 seconds if on status page
        if (window.location.pathname.includes('/status')) {
            setTimeout(() => window.location.reload(), 30000);
        }
    </script>
</body>
</html>